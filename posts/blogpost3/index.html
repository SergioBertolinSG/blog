<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>How to make gradle build to fail hard when parameters are not correct - Sergio Bertolín</title><meta name=description content="Gradle is a build tool widely spread in java projects. It is quite complex inside but it seems easy to make a build.gradle to prepare our project to gather dependencies and run it.
There are three phases in the gradle build, initialization, configuration and execution.
In gradle docs we can see:
Configuration During this phase the project objects are configured. The build scripts of all projects which are part of the build are executed."><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Sergio Bertolín","url":"https:\/\/sergiobertolinsg.github.io\/blog"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/sergiobertolinsg.github.io\/blog"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/sergiobertolinsg.github.io\/blog","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/sergiobertolinsg.github.io\/blog\/posts\/blogpost3\/","name":"How to make gradle build to fail hard when parameters are not correct"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":""},"headline":"How to make gradle build to fail hard when parameters are not correct","description":"Gradle is a build tool widely spread in java projects. It is quite complex inside but it seems easy to make a build.gradle to prepare our project to gather dependencies and run it.\nThere are three phases in the gradle build, initialization, configuration and execution.\nIn gradle docs we can see:\nConfiguration During this phase the project objects are configured. The build scripts of all projects which are part of the build are executed.","inLanguage":"en","wordCount":428,"datePublished":"2021-02-02T19:34:49","dateModified":"2021-02-02T19:34:49","image":"https:\/\/sergiobertolinsg.github.io\/blog","keywords":[""],"mainEntityOfPage":"https:\/\/sergiobertolinsg.github.io\/blog\/posts\/blogpost3\/","publisher":{"@type":"Organization","name":"https:\/\/sergiobertolinsg.github.io\/blog","logo":{"@type":"ImageObject","url":"https:\/\/sergiobertolinsg.github.io\/blog","height":60,"width":60}}}</script><meta property="og:title" content="How to make gradle build to fail hard when parameters are not correct"><meta property="og:description" content="Gradle is a build tool widely spread in java projects. It is quite complex inside but it seems easy to make a build.gradle to prepare our project to gather dependencies and run it.
There are three phases in the gradle build, initialization, configuration and execution.
In gradle docs we can see:
Configuration During this phase the project objects are configured. The build scripts of all projects which are part of the build are executed."><meta property="og:url" content="https://sergiobertolinsg.github.io/blog/posts/blogpost3/"><meta property="og:type" content="website"><meta property="og:site_name" content="Sergio Bertolín"><meta name=twitter:title content="How to make gradle build to fail hard when parameters are not correct"><meta name=twitter:description content="Gradle is a build tool widely spread in java projects. It is quite complex inside but it seems easy to make a build.gradle to prepare our project to gather dependencies and run it.
There are three …"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><link rel=alternate href=https://sergiobertolinsg.github.io/blog/index.xml type=application/rss+xml title="Sergio Bertolín"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://sergiobertolinsg.github.io/blog/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://sergiobertolinsg.github.io/blog/css/syntax.css><link rel=stylesheet href=https://sergiobertolinsg.github.io/blog/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://sergiobertolinsg.github.io/blog>Sergio Bertolín</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=posts-heading><h1>How to make gradle build to fail hard when parameters are not correct</h1><hr class=small></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Gradle is a build tool widely spread in java projects. It is quite complex inside but it seems easy to make a build.gradle to prepare our project to gather dependencies and run it.</p><p>There are three phases in the gradle build, initialization, configuration and execution.</p><p>In gradle docs we can see:</p><pre><code>Configuration
During this phase the project objects are configured. The build scripts of all projects which are part of the build are executed.
</code></pre><p>This can be problematic as your code could run before you expect if you haven&rsquo;t read carefully the documentation.</p><p>Sometimes we want that the build fails hard even before the configuration phase starts.</p><p>When writing shell scripts I like to have at the beginning a way to control the parameters introduced.</p><pre><code>if [ $# -ne 2 ];
then
   echo &quot;Usage: $(basename $0) parametro1 parametro2&quot;
   echo &quot;parametro1: blabla&quot;
   echo &quot;parametro2: bleble&quot;
   exit
fi
</code></pre><p>I&rsquo;d like to have a similar mechanism in gradle. It was a bit hidden but I could find how to do it.</p><p>Gradle allows us to use a settings.gradle file. Usually it is used for multiprojects. But it can be
also used to control the parameters as it runs before the configuration starts. So no code in build.gradle runs before this.</p><p>We also need to make use of gradle exceptions, to make build fail and stop before the configuration phase.</p><p>Lets imagine that to run gradle we pass two properties like -PenvironmentTest=VALUE1 -PapplicationTest=VALUE2.
We want to control that environmentTest is one of the environments available, same with applicationTest.
Also we need to avoid combinations that can lead to problems.</p><p>So in the settings.gradle we write it like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>gradle<span style=color:#f92672>.</span><span style=color:#a6e22e>beforeProject</span> <span style=color:#f92672>{</span> Project project <span style=color:#f92672>-&gt;</span>
    println <span style=color:#e6db74>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; gradle beforeProject &#34;</span> <span style=color:#f92672>+</span> project<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; parameter check&#34;</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>hasProperty</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;environmentTest&#39;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GradleException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Missing property environmentTest&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;environmentTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;PROD&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>
            <span style=color:#f92672>(</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;environmentTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;PREPROD&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>
            <span style=color:#f92672>(</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;environmentTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;TEST&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>
            <span style=color:#f92672>(</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;environmentTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;DEV&#39;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GradleException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;environmentTest must be  PRO, PREPROD, TEST or DEV&#34;</span><span style=color:#f92672>)</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>hasProperty</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;applicationTest&#39;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GradleException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Missing property applicationTest&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;applicationTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;SKYWALKER&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>
            <span style=color:#f92672>(</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;applicationTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;YODA&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>
            <span style=color:#f92672>(</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;applicationTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;ORGANA&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>
            <span style=color:#f92672>(</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;applicationTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;SOLO&#39;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GradleException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;applicationTest must be SKYWALKER, YODA, ORGANA or SOLO&#34;</span><span style=color:#f92672>)</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;environmentTest&#39;</span><span style=color:#f92672>))</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;PROD&#39;</span> <span style=color:#f92672>&amp;&amp;</span> project<span style=color:#f92672>.</span><span style=color:#a6e22e>property</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;applicationTest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;YODA&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GradleException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;PROD environment is only available for YODA&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>This way we check that the parameters are correct before running anything else. If something is not ok, there
is a GradleException and build never starts. If everything is right, the flow continues with the usual gradle behaviour.</p><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fsergiobertolinsg.github.io%2fblog%2fposts%2fblogpost3%2f&text=How%20to%20make%20gradle%20build%20to%20fail%20hard%20when%20parameters%20are%20not%20correct&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsergiobertolinsg.github.io%2fblog%2fposts%2fblogpost3%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fsergiobertolinsg.github.io%2fblog%2fposts%2fblogpost3%2f&title=How%20to%20make%20gradle%20build%20to%20fail%20hard%20when%20parameters%20are%20not%20correct" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fsergiobertolinsg.github.io%2fblog%2fposts%2fblogpost3%2f&title=How%20to%20make%20gradle%20build%20to%20fail%20hard%20when%20parameters%20are%20not%20correct" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fsergiobertolinsg.github.io%2fblog%2fposts%2fblogpost3%2f&title=How%20to%20make%20gradle%20build%20to%20fail%20hard%20when%20parameters%20are%20not%20correct" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fsergiobertolinsg.github.io%2fblog%2fposts%2fblogpost3%2f&description=How%20to%20make%20gradle%20build%20to%20fail%20hard%20when%20parameters%20are%20not%20correct" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://sergiobertolinsg.github.io/blog/posts/blogpost2/ data-toggle=tooltip data-placement=top title="How to use several git accounts in same computer">&larr; Previous Post</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2021
&nbsp;&bull;&nbsp;
<a href=https://sergiobertolinsg.github.io/blog>Sergio Bertolín</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.74.3</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://sergiobertolinsg.github.io/blog/js/main.js></script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://sergiobertolinsg.github.io/blog/js/load-photoswipe.js></script></body></html>